<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Medisch Transcriptiesysteem</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
        textarea { width: 100%; min-height: 200px; font-family: monospace; }
        select, button, input[type="file"] { margin-top: 10px; display: block; width: 100%; }
        .section { margin-top: 30px; }
    </style>
</head>
<body>
    <h1>🩺 Transcriptie & Medisch Verslag</h1>

    <form method="post" action="/transcribe" enctype="multipart/form-data">
        <label for="verslag_type">Verslagtype:</label>
        <select name="verslag_type" id="verslag_type">
            <option value="TTE">TTE</option>
            <option value="TEE">TEE</option>
            <option value="coronarografie">Coronarografie</option>
            <option value="consultatie">Consultatie</option>
            <option value="consult">Consult</option>
        </select>

        <label for="audio_file">Audio uploaden:</label>
        <input type="file" name="audio_file" accept="audio/*" required>

        <button type="submit">🚀 Start transcriptie</button>
    </form>

    <div class="section">
        <h2>Gestructureerd verslag</h2>
        <textarea readonly>{{ transcript }}</textarea>
    </div>

    <div class="section">
        <h2>Advies (ICD-10 & Richtlijnen)</h2>
        <textarea readonly>{{ advies }}</textarea>
    </div>

    <div class="section">
        <h2>Ruwe transcriptie</h2>
        <textarea readonly>{{ raw }}</textarea>
    </div>

    <!-- Dicteerknop -->
    <div class="section">
        <h2>🎙️ Live dicteren (experimenteel)</h2>
        <button onclick="startDictation()">Start dicteren</button>
        <p id="status"></p>
        <audio id="preview" controls style="margin-top:10px;"></audio>
    </div>

    <script>
    function startDictation() {
        const status = document.getElementById('status');
        const preview = document.getElementById('preview');
        status.textContent = "⏺️ Opname gestart...";

        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
            const mediaRecorder = new MediaRecorder(stream);
            const chunks = [];

            mediaRecorder.ondataavailable = e => chunks.push(e.data);
            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'audio/webm' });
                const url = URL.createObjectURL(blob);
                preview.src = url;
                status.textContent = "✅ Opname klaar – download of upload handmatig";
            };

            mediaRecorder.start();
            setTimeout(() => mediaRecorder.stop(), 15000); // 15 sec max
        }).catch(err => {
            status.textContent = "❌ Fout bij microfoon: " + err;
        });
    }
    </script>
</body>
</html>
