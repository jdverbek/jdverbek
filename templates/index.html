<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Transcriptie Medisch Verslag</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    button { padding: 10px; font-size: 1em; margin-top: 10px; width: 100%; }
    .recording { background-color: red; color: white; }
    .stopping { background-color: blue; color: white; }
    textarea { width: 100%; min-height: 200px; margin-top: 10px; font-family: monospace; }
  </style>
</head>
<body>
  <h1>ü©∫ Dicteer of upload voor verslag</h1>

  <form method="post" action="/transcribe" enctype="multipart/form-data" id="uploadForm">
    <label for="verslag_type">Type verslag:</label>
    <select name="verslag_type">
      <option value="TTE">TTE</option>
      <option value="TEE">TEE</option>
    </select>

    <label>Upload audio:</label>
    <input type="file" name="audio_file" id="audioInput" accept="audio/*" />

    <button type="submit">Upload en verwerk</button>
  </form>

  <h3>üéôÔ∏è Of dicteer:</h3>
  <button id="recordBtn" onclick="toggleRecord()">üî¥ Start opname</button>
  <audio id="preview" controls style="display:none; margin-top:10px;"></audio>

  <form id="recordUploadForm" method="post" action="/transcribe" enctype="multipart/form-data" style="display:none;">
    <input type="hidden" name="verslag_type" value="TTE" />
    <input type="file" name="audio_file" id="recordedAudioInput" />
  </form>

  <h2>Verslag</h2>
  <textarea readonly>{{ transcript }}</textarea>

  <h2>Originele transcriptie</h2>
  <textarea readonly>{{ raw }}</textarea>

  <script>
    let recording = false;
    let mediaRecorder, chunks = [];

    function toggleRecord() {
      const btn = document.getElementById("recordBtn");

      if (!recording) {
        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();
          btn.textContent = "üîµ Stop opname";
          btn.className = "stopping";
          recording = true;
          chunks = [];

          mediaRecorder.ondataavailable = e => chunks.push(e.data);
          mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'audio/webm' });
            const file = new File([blob], "dictaat_" + Date.now() + ".webm", { type: 'audio/webm' });

            const fileInput = document.getElementById("recordedAudioInput");
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            fileInput.files = dataTransfer.files;

            document.getElementById("recordUploadForm").submit();
          };
        });
      } else {
        mediaRecorder.stop();
        recording = false;
        btn.textContent = "üî¥ Start opname";
        btn.className = "recording";
      }
    }
  </script>
</body>
</html>
